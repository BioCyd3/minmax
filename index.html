<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mermaid Diagram</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
</head>
<body>
    <div class="mermaid">
        graph TD
            A[Christmas] -->|Get money| B(Go shopping)
            B --> C{Let me think}
            C -->|One| D[Laptop]
            C -->|Two| E[iPhone]
            C -->|Three| F[fa:fa-car Car]
    </div>
    <script>
        mermaid.initialize({ startOnLoad: true });
        const getMermaidCodeFromUrl = () => {
            const hash = window.location.hash.substring(1);
            if (hash.startsWith('pako:')) {
                const encoded = hash.substring(5);
                try {
                    const pako = window.pako;
                    const decoded = pako.inflate(Uint8Array.from(atob(encoded.replace(/_/g, '/').replace(/-/g, '+')), c => c.charCodeAt(0)), { to: 'string' });
                    const json = JSON.parse(decoded);
                    return json.code;
                } catch (e) {
                    console.error('Failed to decode mermaid diagram from URL', e);
                    return 'graph TD\n    A[Error decoding diagram] --> B{Check console for details}';
                }
            }
            return 'graph TD\n    A[No diagram in URL] --> B{Share a diagram to see it here}';
        }

        const renderMermaid = async () => {
            const code = getMermaidCodeFromUrl();
            const mermaidDiv = document.querySelector('.mermaid');
            const { svg } = await mermaid.render('mermaid-graph', code);
            mermaidDiv.innerHTML = svg;
        }

        // Load pako from CDN
        const pakoScript = document.createElement('script');
        pakoScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js';
        pakoScript.onload = () => {
            renderMermaid();
        };
        document.head.appendChild(pakoScript);

    </script>
</body>
</html>